<div class="max-w-6xl w-full">
    <!-- Carousel Container -->
    <div class="relative">
        <!-- Carousel -->
        <div class="flex items-center justify-center h-[233px] relative overflow-hidden rounded-xl bg-white">
            <!-- Carousel items -->
            {{ $Selected := 0 }}
            {{range $id, $data := .eds.mapping }}
                <div class="carousel-item absolute transition-all duration-1000 ease-in-out
                     {{if eq $Selected 0}}
                         w-[233px] h-[233px] top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2 opacity-100 z-20 selected-0
                     {{else}}
                         w-[199px] h-[199px] top-1/2 -translate-y-1/2 opacity-70 z-10
                         {{if eq $Selected 1}}
                             left-[calc(50%-17px-199px)]
                         {{else}}
                             left-[calc(50%+17px+233px)] opacity-0
                         {{end}}
                     {{end}}">
                    <div class="h-full w-full rounded-xl overflow-hidden shadow-lg">
                        <img src="{{$.basePath}}/{{$.eds.relativePath}}{{$id}}.webp" alt="{{$data.name}}"
                             class="w-full h-full object-cover">
                        <div class="rounded-xl absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4 text-white">
                            <h3 class="text-xl font-semibold text-center">{{$data.name}}</h3>
                        </div>
                    </div>
                </div>
                {{ $Selected = addInt $Selected 1}}
            {{end}}
        </div>

        <!-- Navigation Buttons -->
        <button id="prevBtn"
                class="absolute left-[16px] top-1/2 -translate-y-1/2 bg-transparent w-[32px] h-[32px] text-white rounded-full hover:bg-black/70 transition-all duration-300 z-30">
            <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"
                 style="transform: rotate(180deg);">
                <path d="M15.9993 21.3337L21.3327 16.0003M21.3327 16.0003L15.9993 10.667M21.3327 16.0003L10.666 16.0003M29.3327 16.0003C29.3327 23.3641 23.3631 29.3337 15.9993 29.3337C8.63555 29.3337 2.66602 23.3641 2.66602 16.0003C2.66602 8.63653 8.63555 2.66699 15.9993 2.66699C23.3631 2.66699 29.3327 8.63653 29.3327 16.0003Z"
                      stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>

        <button id="nextBtn"

                class="absolute right-[16px] top-1/2 -translate-y-1/2 bg-transparent w-[32px] h-[32px] text-white rounded-full hover:bg-black/70 transition-all duration-300 z-30">
            <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15.9993 21.3337L21.3327 16.0003M21.3327 16.0003L15.9993 10.667M21.3327 16.0003L10.666 16.0003M29.3327 16.0003C29.3327 23.3641 23.3631 29.3337 15.9993 29.3337C8.63555 29.3337 2.66602 23.3641 2.66602 16.0003C2.66602 8.63653 8.63555 2.66699 15.9993 2.66699C23.3631 2.66699 29.3327 8.63653 29.3327 16.0003Z"
                      stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
    </div>
</div>

<script>
    // Carousel state
    let currentIndex = 0;
    const items = document.querySelectorAll('.carousel-item');
    const totalItems = items.length;
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');

    // Update carousel based on current index
    function updateCarousel() {
        items.forEach((item, index) => {
            // Remove all positioning and sizing classes
            item.classList.remove(
                'w-[233px]', 'h-[233px]', 'w-[199px]', 'h-[199px]',
                'left-1/2', '-translate-x-1/2',
                'left-[calc(0px-17px-118px)]', 'right-[calc(0px-17px-118px)]',
                'left-[calc(50%+17px+233px)]', 'left-[calc(50%-17px-199px)]',
                'opacity-100', 'opacity-70', 'opacity-0',
                'z-10', 'z-20'
            );

            if (index === currentIndex) {
                // Current/center image: 233px x 233px, full opacity, highest z-index
                item.classList.add('w-[233px]', 'h-[233px]', 'left-1/2', '-translate-x-1/2', 'opacity-100', 'z-20');
            } else if (index === currentIndex - 1 || (currentIndex === 0 && index === totalItems - 1)) {
                // Left image: 199px x 199px, 17px away from center, reduced opacity
                item.classList.add('w-[199px]', 'h-[199px]', 'left-[calc(0px-17px-118px)]', 'opacity-70', 'z-10');
            } else if (index === currentIndex + 1 || (currentIndex === totalItems - 1 && index === 0)) {
                // Right image: 199px x 199px, 17px away from center, reduced opacity
                item.classList.add('w-[199px]', 'h-[199px]', 'right-[calc(0px-17px-118px)]', 'opacity-70', 'z-10');
            } else {
                // Hidden images: 199px x 199px but invisible
                item.classList.add('w-[199px]', 'h-[199px]', 'left-[calc(50%+17px+233px)]', 'opacity-0', 'z-10');
            }
        });

        // Handle edge cases for first and last items
        if (currentIndex === 0) {
            // When on first item, no left image should be visible
            const lastItem = items[totalItems - 1];
            if (lastItem) {
                lastItem.classList.remove('opacity-70');
                lastItem.classList.add('opacity-0');
            }
        }
    }

    // Next slide
    function nextSlide() {
        currentIndex = (currentIndex + 1) % totalItems;
        updateCarousel();
        htmx.ajax('GET', `{{$.basePath}}/updatePackageDetails?id=${currentIndex}`, {
            target: '#packageDetails',
            swap:'outerHTML'
        })
    }

    // Previous slide
    function prevSlide() {
        currentIndex = (currentIndex - 1 + totalItems) % totalItems;
        updateCarousel();
        htmx.ajax('GET', `{{$.basePath}}/updatePackageDetails?id=${currentIndex}`, {
            target: '#packageDetails',
            swap:'outerHTML'
        })
    }

    // Event listeners
    prevBtn.addEventListener('click', prevSlide);
    nextBtn.addEventListener('click', nextSlide);

    // Initialize carousel
    document.addEventListener('DOMContentLoaded', updateCarousel);
</script>